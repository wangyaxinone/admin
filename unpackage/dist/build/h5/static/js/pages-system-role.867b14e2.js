(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-system-role"],{"0c37":function(e,t,n){"use strict";n.r(t);var a=n("a5d3"),r=n("b60b");for(var s in r)"default"!==s&&function(e){n.d(t,e,(function(){return r[e]}))}(s);var i,o=n("f0c5"),u=Object(o["a"])(r["default"],a["b"],a["c"],!1,null,"df774de0",null,!1,a["a"],i);t["default"]=u.exports},4494:function(e,t,n){"use strict";n("a9e3"),n("e25e"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=n("3153"),r={name:"uniDateformat",props:{date:{type:[Object,String,Number],default:function(){return Date.now()}},locale:{type:String,default:"zh"},threshold:{type:Array,default:function(){return[0,0]}},format:{type:String,default:"yyyy/MM/dd hh:mm:ss"},refreshRate:{type:[Number,String],default:0}},data:function(){return{refreshMark:0}},computed:{dateShow:function(){return this.refreshMark,(0,a.friendlyDate)(this.date,{locale:this.locale,threshold:this.threshold,format:this.format})}},watch:{refreshRate:{handler:function(){this.setAutoRefresh()},immediate:!0}},methods:{refresh:function(){this.refreshMark++},setAutoRefresh:function(){var e=this;clearInterval(this.refreshInterval),this.refreshRate&&(this.refreshInterval=setInterval((function(){e.refresh()}),parseInt(this.refreshRate)))}}};t.default=r},"6f02":function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return a}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"uni-container"},[n("avue-crud",{ref:"crud",attrs:{permission:e.permissionList,option:e.option,"table-loading":e.loading,data:e.data},on:{"row-del":function(t){arguments[0]=t=e.$handleEvent(t),e.rowDel.apply(void 0,arguments)},"row-update":function(t){arguments[0]=t=e.$handleEvent(t),e.rowUpdate.apply(void 0,arguments)},"row-save":function(t){arguments[0]=t=e.$handleEvent(t),e.rowSave.apply(void 0,arguments)},"search-change":function(t){arguments[0]=t=e.$handleEvent(t),e.searchChange.apply(void 0,arguments)},"search-reset":function(t){arguments[0]=t=e.$handleEvent(t),e.searchReset.apply(void 0,arguments)},"selection-change":function(t){arguments[0]=t=e.$handleEvent(t),e.selectionChange.apply(void 0,arguments)},"on-load":function(t){arguments[0]=t=e.$handleEvent(t),e.loadData.apply(void 0,arguments)},"cell-click":function(t){arguments[0]=t=e.$handleEvent(t),e.cellClick.apply(void 0,arguments)}},scopedSlots:e._u([{key:"create_date",fn:function(e){return[n("uniDateformate",{attrs:{date:e.row.create_date}})]}},{key:"menuLeft",fn:function(t){return[n("el-button",{attrs:{type:"danger",icon:"el-icon-plus",size:"small",plain:!0},on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.addRolePermissions()}}},[e._v("权限")])]}}]),model:{value:e.form,callback:function(t){e.form=t},expression:"form"}}),n("uniRolePermissions",{ref:"uniRolePermissions",attrs:{type:e.currentSelect.type,defaultCheckedKeys:e.defaultCheckedKeys,menusTree:e.menusTree},on:{permissionsSubmit:function(t){arguments[0]=t=e.$handleEvent(t),e.permissionsSubmit.apply(void 0,arguments)}}})],1)},s=[]},7784:function(e,t,n){"use strict";n.r(t);var a=n("c9c3"),r=n.n(a);for(var s in a)"default"!==s&&function(e){n.d(t,e,(function(){return a[e]}))}(s);t["default"]=r.a},9490:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tree=t.remove=t.update=t.add=t.getList=void 0;var a=n("65a6"),r=function(e){return(0,a.request)("system/tenant/list",e)};t.getList=r;var s=function(e){return(0,a.request)("system/tenant/add",e)};t.add=s;var i=function(e){return(0,a.request)("system/tenant/update",e)};t.update=i;var o=function(e){return(0,a.request)("system/tenant/remove",e)};t.remove=o;var u=function(e){return(0,a.request)("system/tenant/tree",e)};t.tree=u},a2b2:function(e,t,n){"use strict";n.r(t);var a=n("6f02"),r=n("7784");for(var s in r)"default"!==s&&function(e){n.d(t,e,(function(){return r[e]}))}(s);var i,o=n("f0c5"),u=Object(o["a"])(r["default"],a["b"],a["c"],!1,null,"7e21fd19",null,!1,a["a"],i);t["default"]=u.exports},a5d3:function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return a}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",[n("el-dialog",{attrs:{title:"权限",visible:e.dialogPermissions,width:"30%"},on:{"update:visible":function(t){arguments[0]=t=e.$handleEvent(t),e.dialogPermissions=t}}},[n("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"菜单权限",name:"menu"}},[n("el-tree",{ref:"tree",attrs:{"default-checked-keys":e.defaultCheckedKeys,data:e.menusTree,"default-expand-all":!0,"check-strictly":!0,"show-checkbox":!0,"node-key":"_id",props:e.defaultProps}}),n("v-uni-view",{staticStyle:{"text-align":"center","margin-top":"20px"}},[n("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submitMenuPermissions.apply(void 0,arguments)}}},[e._v("保存")]),n("el-button",{attrs:{size:"small"}},[e._v("取消")])],1)],1),1==e.type?n("el-tab-pane",{attrs:{label:"数据权限",name:"data"}},[n("el-radio-group",{model:{value:e.dataPermissions,callback:function(t){e.dataPermissions=t},expression:"dataPermissions"}},[n("el-radio",{attrs:{label:3}},[e._v("门店及子门店所属数据")]),n("el-radio",{attrs:{label:6}},[e._v("门店所属数据")]),n("el-radio",{attrs:{label:9}},[e._v("账号所属数据")])],1)],1):e._e()],1)],1)],1)},s=[]},aa62:function(e,t,n){"use strict";n.r(t);var a=n("4494"),r=n.n(a);for(var s in a)"default"!==s&&function(e){n.d(t,e,(function(){return a[e]}))}(s);t["default"]=r.a},b60b:function(e,t,n){"use strict";n.r(t);var a=n("cf4b"),r=n.n(a);for(var s in a)"default"!==s&&function(e){n.d(t,e,(function(){return a[e]}))}(s);t["default"]=r.a},c9c3:function(e,t,n){"use strict";var a=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,s=a(n("5530")),i=n("9490"),o=n("e152"),u=a(n("e6a2")),l=a(n("0c37")),c=n("2f62"),d={components:{uniDateformate:u.default,uniRolePermissions:l.default},computed:(0,s.default)((0,s.default)({},(0,c.mapState)("app",["navBtn"])),{},{permissionList:function(){return{addBtn:this.navBtn.system_role_add||!1,viewBtn:this.navBtn.system_role_list||!1,delBtn:this.navBtn.system_role_remove||!1,editBtn:this.navBtn.system_role_update||!1}}}),data:function(){return{loading:!1,selection:[],form:{},params:{},option:{height:"auto",calcHeight:80,searchShow:!0,searchMenuSpan:6,rowKey:"_id",tip:!1,tree:!0,border:!0,index:!0,selection:!0,viewBtn:!0,defaultExpandAll:!0,menuWidth:300,column:[{label:"角色名",prop:"role_name",search:!0,width:250,span:12,rules:[{required:!0,message:"请输入角色名",trigger:"blur"}]},{label:"所属门店",prop:"tenantId",type:"tree",span:12,width:150,dicData:[],props:{label:"name",value:"_id"},search:!0,rules:[{required:!0,message:"请输入所属租户",trigger:"change"}]},{label:"上级角色",prop:"parent_id",span:12,width:150,type:"tree",hide:!0,dicData:[],props:{label:"role_name",value:"_id"},rules:[{required:!0,message:"请选择上级角色",trigger:"change"}]},{label:"门店管理员",prop:"type",span:12,type:"select",width:120,value:2,dicData:[{label:"是",value:1},{label:"否",value:2}],rules:[{required:!0,message:"请选择是否是门店管理员",trigger:"change"}]},{label:"备注",prop:"comment",span:12,width:150,rules:[{required:!1,message:"请输入备注",trigger:"change"}]},{label:"排序",prop:"sort",span:12,width:100,type:"number",rules:[{required:!0,message:"请输入排序",trigger:"change"}]},{label:"创建时间",prop:"create_date",slot:!0,width:150,span:12,display:!1}]},data:[],menusTree:[],defaultCheckedKeys:[],currentSelect:{}}},created:function(){r=this,(0,i.tree)().then((function(e){var t=r.findObject(r.option.column,"tenantId");t.dicData=e}))},watch:{"form.tenantId":{handler:function(e){e&&(0,o.tree)({tenantId:e}).then((function(e){var t=r.findObject(r.option.column,"parent_id");t.dicData=e}))},deep:!0}},methods:{cellClick:function(e,t,n,a){this.$refs.crud.toggleRowSelection(e)},permissionsSubmit:function(e){var t=this;(0,o.setRoleMenus)({_id:this.selection[0]._id,permission:e}).then((function(){t.$refs.uniRolePermissions.hide(),t.$message({message:"保存成功",type:"success"}),t.loadData()}))},addRolePermissions:function(){var e=this;this.selection&&this.selection.length?this.selection.length>1?this.$message({message:"只能选择一项",type:"warning"}):(this.currentSelect=this.selection[0],(0,o.getRoleMenus)({parent_id:this.selection[0].parent_id,type:this.selection[0].type}).then((function(t){e.menusTree=t,e.defaultCheckedKeys=e.selection[0].permission,e.$refs.uniRolePermissions.show()}))):this.$message({message:"请先选择角色",type:"warning"})},rowDel:function(e){var t=this;e.children&&e.children.length?this.$message({message:"请先删除子菜单！",type:"warning"}):this.$confirm("确定将选择数据删除?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){(0,o.remove)({_ids:[e._id]}).then((function(e){t.$message({message:"删除成功",type:"success"}),t.loadData()}))}))},rowUpdate:function(e,t,n,a){var r=this;(0,o.update)(e).then((function(){r.loadData(),r.$message({message:"修改成功",type:"success"}),n()})).catch((function(e){n()}))},rowSave:function(e,t,n){var a=this;(0,o.add)(e).then((function(){a.loadData(),a.$message({message:"新增成功",type:"success"}),t()})).catch((function(e){t()}))},searchReset:function(){this.params={},this.loadData()},searchChange:function(e,t){this.params=e,this.loadData(),t()},selectionChange:function(e){this.selection=e},loadData:function(){var e=this;this.loading=!0,(0,o.tree)(this.params).then((function(t){e.loading=!1,e.data=t,(0,o.tree)().then((function(t){var n=e.findObject(e.option.column,"parent_id");n.dicData=t}))})).catch((function(){e.loading=!1}))}}};t.default=d},cf4b:function(e,t,n){"use strict";n("a9e3"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a={data:function(){return{dialogPermissions:!1,dataPermissions:"",activeName:"menu",defaultProps:{children:"children",label:"name"}}},props:{type:{type:String|Number},defaultCheckedKeys:{type:Array},menusTree:{type:Array}},methods:{show:function(){this.dialogPermissions=!0},hide:function(){this.dialogPermissions=!1},submitMenuPermissions:function(){var e=this.$refs.tree.getCheckedKeys();this.$emit("permissionsSubmit",e)}}};t.default=a},dac0:function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return a}));var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-text",[e._v(e._s(e.dateShow))])},s=[]},e152:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setRoleMenus=t.getRoleMenus=t.tree=t.remove=t.update=t.add=t.getList=void 0;var a=n("65a6"),r=function(e){return(0,a.request)("system/role/list",e)};t.getList=r;var s=function(e){return(0,a.request)("system/role/add",e)};t.add=s;var i=function(e){return(0,a.request)("system/role/update",e)};t.update=i;var o=function(e){return(0,a.request)("system/role/remove",e)};t.remove=o;var u=function(e){return(0,a.request)("system/role/tree",e)};t.tree=u;var l=function(e){return(0,a.request)("system/role/getRoleMenus",e)};t.getRoleMenus=l;var c=function(e){return(0,a.request)("system/role/setRoleMenus",e)};t.setRoleMenus=c},e6a2:function(e,t,n){"use strict";n.r(t);var a=n("dac0"),r=n("aa62");for(var s in r)"default"!==s&&function(e){n.d(t,e,(function(){return r[e]}))}(s);var i,o=n("f0c5"),u=Object(o["a"])(r["default"],a["b"],a["c"],!1,null,"808c1684",null,!1,a["a"],i);t["default"]=u.exports}}]);